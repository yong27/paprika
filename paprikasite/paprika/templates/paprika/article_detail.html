{% extends "paprika/base_site.html" %}
{% load i18n markup comments %}

{% block extrahead %}
{{ block.super }}
<script type="text/javascript' %}">
$('#comment-tab a').click(function(e) {
    e.preventDefault();
    $(this).tab('show');
})
</script>
{% endblock %}

{% block title %}{{ article.title }} | {{ board.title }}{% endblock %}

{% block content %}
<h4>{{ article.title }}</h4>
<p class="text-right"><a href="{% url 'category_detail' board.slug article.category.slug %}">{{ article.category.title }}</a> - <small><a href="{% url 'article_detail' article.id article.slug %}">{{ article.created_datetime }}</a></small></p>

{% if article.board.markup == 'markdown' %}
    {{ article.content|markdown:"safe" }}
{% else %}
    {{ article.content|safe }}
{% endif %}

<br />
<p><strong>{% trans 'Tags' %}:</strong>
{% for tag in article.tags.all %}
    <a href="{% url 'tag_detail' board.slug tag.slug %}">{{ tag.slug }}</a>{% if not forloop.last %}, {% endif %}
{% endfor %}
</p>

<br />
<h5>{% trans 'Comments' %}</h5>
{% get_comment_count for article as comment_count %}

<ul class="nav nav-tabs">
    <li class="active">
        <a href="#paprika-comment" data-toggle="tab">Paprika comment ({{ comment_count }})</a>
    </li>
    <li><a href="#facebook" data-toggle="tab">Facebook</a></li>
    <li><a href="#twitter" data-toggle="tab">Disqus</a></li>
</ul>

<div class="tab-content">
    <div class="tab-pane active" id="paprika-comment">
    {% render_comment_list for article %}
    <hr />
    {% get_comment_form for article as form %}
    <form action="{% comment_form_target %}" method="post" class="form-horizontal">
        {% csrf_token %}
        {{ form.content_type }}
        {{ form.object_pk }}
        {{ form.timestamp }}
        {{ form.security_hash }}
        <div class="control-group">
            <label class="control-label" for="id_name">{{ form.name.label }}</label>
            <div class="controls">
                <input id="id_name" type="text" name="name" placeholder="{{ form.name.label }}" />
            </div>
        </div>
        <div class="control-group">
            <label class="control-label" for="id_email">{{ form.email.label }}</label>
            <div class="controls">
                <input id="id_email" type="text" name="email" placeholder="{{ form.email.label }}" />
            </div>
        </div>
        <div class="control-group">
            <label class="control-label" for="id_url">{{ form.url.label }}</label>
            <div class="controls">
                <input id="id_url" type="text" name="url" placeholder="{{ form.url.label }}" />
            </div>
        </div>
        <div style="display:none;">
            <label class="control-label" for="id_honeypot">{{ form.honeypot.label }}</label>
            <div class="controls">
                <input id="id_honeypot" type="text" name="honeypot" placeholder="{{ form.honeypot.label }}" />
            </div>
        </div>
        <div class="control-group">
            <label class="control-label" for="id_comment">{{ form.comment.label }}</label>
            <div class="controls">
                <textarea id="id_comment" type="text" name="comment" rows="5" placeholder="{{ form.comment.label }}" class="input-xlarge"></textarea>
            </div>
        </div>
        <div class="control-group">
            <div class="controls">
                <button type="submit" class="btn">{% trans "Submit" %}</button>
            </div>
        </div>
    </form>
    </div>

    {% if fb_comment_app_id %}
    <div class="tab-pane" id="facebook">
        <div id="fb-root"></div>
        <script>(function(d, s, id) {
          var js, fjs = d.getElementsByTagName(s)[0];
          if (d.getElementById(id)) return;
          js = d.createElement(s); js.id = id;
          js.src = "//connect.facebook.net/ko_KR/all.js#xfbml=1&appId={{ fb_comment_app_id }}";
          fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));</script>
        <div class="fb-comments" data-href="http://{{ http_host }}{{ article.get_absolute_url }}" data-width="700" data-num-posts="10"></div>
    </div>
    {% endif %}

    {% if disqus_shortname %}
    <div class="tab-pane" id="twitter">
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = '{{ disqus_shortname }}'; // required: replace example with your forum shortname

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
        <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = '{{ disqus_shortname }}'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script'); s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
        </script>
    </div>
    {% endif %}
</div>
<hr />

{{ request.get_pull_path }}

<p>
{% if article.get_previous %}
<strong>Previous article</strong> <a href="{{ article.get_previous.get_absolute_url }}">{{ article.get_previous.title }}</a>...
{% endif %}
{% if article.get_next %}
...<strong>Next article</strong> <a href="{{ article.get_next.get_absolute_url }}">{{ article.get_next.title }}</a>
{% endif %}

{% endblock %}
